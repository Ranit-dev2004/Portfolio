import{r as e,d as oe,e as J,W as he,S as ie,P as we,f as ye,G as $,A as ve,D as q,g as K,h as Me,M as Q,i as U,O as Re,k as Se,l as ee,H as xe,V as be,j as V,C as re,m as _,n as N,o as Te}from"./entry.client-g4LGL3oA.js";import{u as Ae,r as Ce}from"./image-C37Vwfgw.js";import{c as Le,b as Pe,n as ke}from"./heading-CxbOS-bD.js";import{r as ze,c as Ee,a as De,t as Be,b as te,m as Ge}from"./three-Cv03_sgO.js";import{M as ne}from"./route-Cks6zTtg.js";import"./button-C1QwbVqQ.js";import"./meta-BdIzV3m_.js";import"./config-BOA3yL5D.js";import"./decoder-text-BkZG1iDY.js";import"./section-B32nzvjX.js";import"./useWindowSize-BiKi-vjD.js";import"./divider-ByaUN37T.js";const We="_model_9lrnh_3",_e="_canvas_9lrnh_21",ae={model:We,canvas:_e},se={Frame:"Frame",Logo:"Logo",Screen:"Screen"},ce={stiffness:40,damping:20,mass:1.4,restSpeed:.001},qe=({models:k,show:R=!0,showDelay:z=0,cameraPosition:h={x:0,y:0,z:8},style:E,className:D,onLoad:j,alt:S,...B})=>{const[x,H]=e.useState(!1),m=e.useRef(),l=e.useRef(),o=e.useRef(),w=e.useRef(),t=e.useRef(),r=e.useRef(),d=e.useRef(),p=e.useRef(),g=e.useRef(),y=e.useRef(),c=e.useRef(),u=e.useRef(),n=e.useRef(),f=e.useRef(),v=e.useRef(),a=e.useRef(),G=e.useRef(),Y=Ae(m,!1,{threshold:.2}),Z=oe(),b=J(0,ce),T=J(0,ce);e.useEffect(()=>{const{clientWidth:s,clientHeight:i}=m.current;r.current=new he({canvas:l.current,alpha:!0,antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),r.current.setPixelRatio(2),r.current.setSize(s,i),r.current.outputColorSpace=ie,o.current=new we(36,s/i,.1,100),o.current.position.set(h.x,h.y,h.z),t.current=new ye,w.current=new $,t.current.add(w.current);const M=new ve(16777215,1.2),C=new q(16777215,1.1),L=new q(16777215,.8);L.position.set(-6,2,2),C.position.set(.5,0,.866),v.current=[M,C,L],v.current.forEach(P=>t.current.add(P)),d.current=new $,t.current.add(d.current),d.current.position.set(0,0,-.8),d.current.rotateX(Math.PI/2);const W=512,F=8,X=8,ue=1.5,le=.8,de=3;p.current=new K(W,W),p.current.texture.generateMipmaps=!1,g.current=new K(W,W),g.current.texture.generateMipmaps=!1;const O=new Me(F,X).rotateX(Math.PI/2),pe=new Q({map:p.current.texture,opacity:le,transparent:!0});f.current=new U(O,pe),f.current.scale.y=-1,d.current.add(f.current),a.current=new U(O),a.current.visible=!1,d.current.add(a.current);const fe=new Q({color:16777215,opacity:0,transparent:!0});G.current=new U(O,fe),G.current.rotateX(Math.PI),G.current.position.y-=1e-5,d.current.add(G.current),y.current=new Re(-F/2,F/2,X/2,-X/2,0,ue),y.current.rotation.x=Math.PI/2,d.current.add(y.current),c.current=new Se,c.current.userData.darkness={value:de},c.current.onBeforeCompile=P=>{P.uniforms.darkness=c.current.userData.darkness,P.fragmentShader=`
        uniform float darkness;
        ${P.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );")}
      `},c.current.depthTest=!1,c.current.depthWrite=!1,u.current=new ee(xe),u.current.depthTest=!1,n.current=new ee(be),n.current.depthTest=!1;const me=b.on("change",A),ge=T.on("change",A);return()=>{p.current.dispose(),g.current.dispose(),ze(v.current),Ee(t.current),De(r.current),me(),ge()}},[]);const I=e.useCallback(s=>{a.current.visible=!0,a.current.material=u.current,a.current.material.uniforms.tDiffuse.value=p.current.texture,u.current.uniforms.h.value=s*(1/256),r.current.setRenderTarget(g.current),r.current.render(a.current,y.current),a.current.material=n.current,a.current.material.uniforms.tDiffuse.value=g.current.texture,n.current.uniforms.v.value=s*(1/256),r.current.setRenderTarget(p.current),r.current.render(a.current,y.current),a.current.visible=!1},[]),A=e.useCallback(()=>{const i=t.current.background;t.current.background=null,t.current.overrideMaterial=c.current,r.current.setRenderTarget(p.current),r.current.render(t.current,y.current),t.current.overrideMaterial=null,I(5),I(5*.4),r.current.setRenderTarget(null),t.current.background=i,w.current.rotation.x=b.get(),w.current.rotation.y=T.get(),r.current.render(t.current,o.current)},[I,b,T]);return e.useEffect(()=>{const s=Be(i=>{const{innerWidth:M,innerHeight:C}=window,L={x:(i.clientX-M/2)/M,y:(i.clientY-C/2)/C};T.set(L.x/2),b.set(L.y/2)},100);return Y&&!Z&&window.addEventListener("mousemove",s),()=>{window.removeEventListener("mousemove",s)}},[Y,Z,b,T]),e.useEffect(()=>{const s=()=>{if(!m.current)return;const{clientWidth:i,clientHeight:M}=m.current;r.current.setSize(i,M),o.current.aspect=i/M,o.current.updateProjectionMatrix(),A()};return window.addEventListener("resize",s),s(),()=>{window.removeEventListener("resize",s)}},[A]),V.jsxs("div",{className:Le(ae.model,D),"data-loaded":x,style:Pe({delay:ke(z)},E),ref:m,role:"img","aria-label":S,...B,children:[V.jsx("canvas",{className:ae.canvas,ref:l}),k.map((s,i)=>V.jsx(je,{renderer:r,modelGroup:w,show:R,showDelay:z,renderFrame:A,index:i,setLoaded:H,onLoad:j,model:s},JSON.stringify(s.position)))]})},je=({renderer:k,model:R,modelGroup:z,renderFrame:h,index:E,showDelay:D,setLoaded:j,onLoad:S,show:B})=>{const[x,H]=e.useState(),m=oe(),l=e.createRef();e.useEffect(()=>{const o=async(t,r)=>{t.colorSpace=ie,t.flipY=!1,t.anisotropy=k.current.capabilities.getMaxAnisotropy(),t.generateMipmaps=!1,await k.current.initTexture(t),r.material.color=new re(16777215),r.material.transparent=!0,r.material.map=t};H({start:async()=>{const{texture:t,position:r,url:d}=R;let p,g;const[y,c]=await Promise.all([await te.loadAsync(t.placeholder),await Ge.loadAsync(d)]);z.current.add(c.scene),c.scene.traverse(async n=>{n.material&&(n.material.color=new re(2039845)),n.name===se.Screen&&(l.current=n.clone(),l.current.material=n.material.clone(),n.parent.add(l.current),l.current.material.opacity=1,l.current.position.z+=.001,o(y,l.current),p=async()=>{const f=await Ce(t),v=await te.loadAsync(f);await o(v,n),N(1,0,{onUpdate:a=>{l.current.material.opacity=a,h()}})})});const u=new _(r.x,r.y,r.z);return m&&c.scene.position.set(...u.toArray()),R.animation===ne.SpringUp&&(g=()=>{const n=new _(u.x,u.y-1,u.z);c.scene.position.set(...n.toArray()),N(n.y,u.y,{type:"spring",delay:(300*E+D)/1e3,stiffness:60,damping:20,mass:1,restSpeed:1e-4,restDelta:1e-4,onUpdate:f=>{c.scene.position.y=f,h()}})}),R.animation===ne.LaptopOpen&&(g=()=>{const n=c.scene.children.find(a=>a.name===se.Frame),f=new _(Te.degToRad(90),0,0),v=new _(0,0,0);return c.scene.position.set(...u.toArray()),n.rotation.set(...f.toArray()),N(f.x,v.x,{type:"spring",delay:(300*E+D+300)/1e3,stiffness:80,damping:20,restSpeed:1e-4,restDelta:1e-4,onUpdate:a=>{n.rotation.x=a,h()}})}),{loadFullResTexture:p,playAnimation:g}}})},[]),e.useEffect(()=>{if(!x||!B)return;let o;const w=async()=>{const{loadFullResTexture:t,playAnimation:r}=await x.start();j(!0),S==null||S(),m||(o=r()),await t(),m&&h()};return e.startTransition(()=>{w()}),()=>{o==null||o.stop()}},[x,B])};export{qe as Model};
